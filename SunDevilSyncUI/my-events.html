<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Events - Sun Devil Central</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
</head>

<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="logo">ğŸ”± Sun Devil Central</div>
        <ul class="top-nav-menu">
            <li><a href="index.html">Home</a></li>
            <li><a href="groups.html">Groups</a></li>
            <li><a href="events.html">Events</a></li>
            <li><a href="badges.html">Badges</a></li>
            <li><a href="verify.html">Verify Badge</a></li>
            <li><a href="admin.html">Admin</a></li>
        </ul>
        <div class="top-nav-right">
            <span class="nav-icon" title="Search">ğŸ”</span>
            <span class="nav-icon" title="Bookmarks">ğŸ”–</span>
            <span class="nav-icon" title="Notifications">ğŸ””<span class="badge">3</span></span>
            <span class="nav-icon" title="My Account">ğŸ‘¤</span>
        </div>
    </nav>

    <div class="page-wrapper">
        <main class="main-content">
            <h1 class="page-title">My Events</h1>

            <!-- Upcoming Events -->
            <section class="mb-3">
                <div class="section-header">
                    <h2 class="section-title">ğŸ“… Upcoming Events</h2>
                </div>
                <div id="upcoming-events-list">
                    <!-- Events will be loaded here -->
                </div>
            </section>

            <!-- Past Events -->
            <section class="mb-3">
                <div class="section-header">
                    <h2 class="section-title">ğŸ•°ï¸ Past Events</h2>
                </div>
                <div id="past-events-list" class="opacity-75">
                    <!-- Past events will be loaded here -->
                </div>
            </section>
        </main>
    </div>

    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            await auth.checkAuth();
            if (!currentUser) {
                window.location.href = 'index.html';
                return;
            }

            try {
                // Load all events
                const allEvents = await api.get('/events');

                // Load my RSVPs
                const myRsvpIds = await api.get('/my-rsvps');

                // Filter my events
                const myEvents = allEvents.filter(e => myRsvpIds.includes(e.id));

                // Split into upcoming and past
                const now = new Date();
                const upcoming = myEvents.filter(e => new Date(e.date) >= now);
                const past = myEvents.filter(e => new Date(e.date) < now);

                displayEvents('upcoming-events-list', upcoming, false);
                displayEvents('past-events-list', past, true);

            } catch (error) {
                console.error('Error loading my events:', error);
            }
        });

        function displayEvents(containerId, events, isPast) {
            const container = document.getElementById(containerId);
            if (events.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“…</div>
                        <h3 class="empty-state-title">No ${isPast ? 'past' : 'upcoming'} events</h3>
                        <p class="empty-state-description">You haven't ${isPast ? 'attended' : 'RSVP\'d to'} any events yet.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = events.map(event => `
                <div class="card event-card mb-2">
                    <div class="event-card-image"></div>
                    <div class="event-card-content">
                        <div class="event-card-header">
                            <div>
                                <h3 class="event-card-title">${event.title}</h3>
                                <div class="event-card-date">ğŸ“… ${formatDate(event.date)} at ${event.time}</div>
                                <div class="event-card-location">ğŸ“ ${event.location}</div>
                            </div>
                            ${event.isFree ? '<span class="event-free-tag">FREE</span>' : ''}
                        </div>
                        <p class="event-card-description">${event.description}</p>
                        <div class="event-card-footer">
                            <span class="event-host">Hosted by ${event.hostGroup}</span>
                            <a href="event-detail.html?id=${event.id}" class="btn btn-sm btn-primary">View Details</a>
                        </div>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>

</html>
