<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sun Devil Central - ASU</title>
    <meta name="description"
        content="ASU Sun Devil Central - Your hub for student organizations, events, and campus involvement">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
</head>

<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="logo">ğŸ”± Sun Devil Central</div>
        <ul class="top-nav-menu">
            <li><a href="index.html" class="active">Home</a></li>
            <li><a href="groups.html">Groups</a></li>
            <li><a href="events.html">Events</a></li>
        </ul>
        <div class="top-nav-right">
            <span class="nav-icon" title="Search">ğŸ”</span>
            <span class="nav-icon" title="Bookmarks">ğŸ”–</span>
            <span class="nav-icon" title="Notifications">ğŸ””<span class="badge">3</span></span>
            <span class="nav-icon" title="My Account">ğŸ‘¤</span>
            <div class="auth-buttons">
                <button id="login-btn" class="btn-secondary">Login</button>
                <button id="logout-btn" class="btn-secondary" style="display: none;">Logout</button>
                <span id="user-display" style="display: none; margin-right: 10px; color: white;"></span>
            </div>
        </div>
    </nav>
    </header>

    <!-- Login Modal -->
    <div id="login-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Student Login</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn-primary">Login</button>
                <p id="login-error" style="color: red;"></p>
            </form>
        </div>
    </div>

    <!-- Page Wrapper -->
    <div class="page-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3>Navigation</h3>
                <ul class="sidebar-menu">
                    <li><a href="index.html" class="active">ğŸ  Home</a></li>
                    <li><a href="#">ğŸ†” ID Card</a></li>
                    <li><a href="#">ğŸ“° Feed</a></li>
                    <li><a href="#">ğŸ† Leaderboard</a></li>
                </ul>
            </div>
            <div class="sidebar-section">
                <h3>My Activity</h3>
                <ul class="sidebar-menu">
                    <li><a href="#">ğŸ“… My Schedule</a></li>
                    <li><a href="#">ğŸ‘¥ My Groups</a></li>
                    <li><a href="#">ğŸ‰ My Events</a></li>
                    <li><a href="#">ğŸ“‹ My Checklists</a></li>
                    <li><a href="#">ğŸ“Š My Involvement</a></li>
                </ul>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Hero Section -->
            <section class="hero">
                <h1 class="hero-title">Welcome to Sun Devil Central</h1>
                <p class="hero-subtitle">Your hub for student organizations, events, and campus involvement at ASU</p>
                <div class="hero-actions">
                    <a href="groups.html" class="btn btn-secondary btn-lg">JOIN A GROUP</a>
                    <a href="#" class="btn btn-outline btn-lg">REGISTER A GROUP</a>
                </div>
            </section>

            <!-- Announcements -->
            <section class="mb-3">
                <div class="section-header">
                    <h2 class="section-title">ğŸ“¢ Announcements</h2>
                </div>
                <div class="grid grid-2" id="announcements-grid">
                    <!-- Announcements will be loaded here -->
                </div>
            </section>

            <!-- My Groups -->
            <section class="mb-3">
                <div class="section-header">
                    <h2 class="section-title">ğŸ‘¥ My Groups</h2>
                    <a href="groups.html" class="section-link">View All â†’</a>
                </div>
                <div class="grid grid-3" id="my-groups-grid">
                    <!-- My groups will be loaded here -->
                </div>
            </section>

            <!-- Suggested Groups -->
            <section class="mb-3">
                <div class="section-header">
                    <h2 class="section-title">âœ¨ Suggested Groups</h2>
                    <a href="groups.html" class="section-link">View All â†’</a>
                </div>
                <div class="grid grid-3" id="suggested-groups-grid">
                    <!-- Suggested groups will be loaded here -->
                </div>
            </section>

            <!-- Upcoming Events -->
            <section class="mb-3">
                <div class="section-header">
                    <h2 class="section-title">ğŸ“… Upcoming Events</h2>
                    <a href="events.html" class="section-link">View All â†’</a>
                </div>
                <div id="upcoming-events-list">
                    <!-- Events will be loaded here -->
                </div>
            </section>

            <!-- Funding Opportunities -->
            <section class="mb-3">
                <div class="section-header">
                    <h2 class="section-title">ğŸ’° Funding Opportunities</h2>
                </div>
                <div class="grid grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">GSO Event Funding</h3>
                            <span class="tag tag-primary">Up to $2,000</span>
                        </div>
                        <div class="card-body">
                            <p>Funding for student organization events and activities. Applications reviewed monthly.
                            </p>
                        </div>
                        <div class="card-footer">
                            <span class="text-secondary">Deadline: Rolling</span>
                            <a href="#" class="btn btn-sm btn-primary">Apply Now</a>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Operations Funding</h3>
                            <span class="tag tag-primary">Up to $5,000</span>
                        </div>
                        <div class="card-body">
                            <p>Support for ongoing operational costs including supplies, equipment, and materials.</p>
                        </div>
                        <div class="card-footer">
                            <span class="text-secondary">Deadline: Dec 15, 2025</span>
                            <a href="#" class="btn btn-sm btn-primary">Apply Now</a>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Research Grant</h3>
                            <span class="tag tag-secondary">Up to $1,500</span>
                        </div>
                        <div class="card-body">
                            <p>Undergraduate research funding for independent projects and faculty-mentored research.
                            </p>
                        </div>
                        <div class="card-footer">
                            <span class="text-secondary">Deadline: Jan 31, 2026</span>
                            <a href="#" class="btn btn-sm btn-secondary">Learn More</a>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Travel Grant</h3>
                            <span class="tag tag-secondary">Up to $1,000</span>
                        </div>
                        <div class="card-body">
                            <p>Graduate student travel funding for conferences, presentations, and professional
                                development.</p>
                        </div>
                        <div class="card-footer">
                            <span class="text-secondary">Deadline: Rolling</span>
                            <a href="#" class="btn btn-sm btn-secondary">Learn More</a>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="js/main.js"></script>
    <script>
        // Load homepage data
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Load announcements (Static for now)
                const announcementsRes = await fetch('data/announcements.json');
                const announcements = await announcementsRes.json();
                displayAnnouncements(announcements);

                // Load groups from API
                const groups = await api.get('/groups');

                // Wait for auth check to complete (simple delay or check)
                // In a real app, we'd use an event or promise. 
                // For now, we'll assume auth.checkAuth() in main.js runs quickly or we re-check.
                // Better: let's fetch my-groups if logged in.

                let myGroupIds = [];
                if (currentUser) {
                    myGroupIds = await api.get('/my-groups');
                } else {
                    // If not logged in, maybe check local storage or just show nothing
                    // But main.js handles auth check on load. 
                    // Let's wait a bit or hook into auth.
                }

                // Display my groups (Mocking the wait for auth)
                setTimeout(async () => {
                    if (currentUser) {
                        const myGroupIds = await api.get('/my-groups');
                        const myGroups = groups.filter(g => myGroupIds.includes(g.id));
                        displayMyGroups(myGroups);

                        // Display suggested groups (groups not in my groups)
                        const suggestedGroups = groups.filter(g => !myGroupIds.includes(g.id)).slice(0, 3);
                        displaySuggestedGroups(suggestedGroups);
                    } else {
                        document.getElementById('my-groups-grid').innerHTML = '<p class="text-secondary">Login to see your groups</p>';
                        displaySuggestedGroups(groups.slice(0, 3));
                    }
                }, 500);

                // Load and display events from API
                const events = await api.get('/events');
                displayUpcomingEvents(events.slice(0, 3));
            } catch (error) {
                console.error('Error loading data:', error);
            }
        });

        function displayAnnouncements(announcements) {
            const grid = document.getElementById('announcements-grid');
            grid.innerHTML = announcements.map(announcement => `
                <div class="card announcement-card">
                    <span class="announcement-badge ${announcement.badge.toLowerCase()}">${announcement.badge}</span>
                    <h3 class="announcement-title">${announcement.title}</h3>
                    <p class="announcement-content">${announcement.content}</p>
                    <div class="announcement-date">${new Date(announcement.date).toLocaleDateString()}</div>
                </div>
            `).join('');
        }

        function displayMyGroups(groups) {
            const grid = document.getElementById('my-groups-grid');
            grid.innerHTML = groups.map(group => createGroupCard(group)).join('');
        }

        function displaySuggestedGroups(groups) {
            const grid = document.getElementById('suggested-groups-grid');
            grid.innerHTML = groups.map(group => createGroupCard(group)).join('');
        }

        function createGroupCard(group) {
            return `
                <div class="card group-card">
                    <div class="group-card-image"></div>
                    <div class="group-card-content">
                        <h3 class="group-card-title">${group.name}</h3>
                        <div class="group-card-meta">
                            <span>ğŸ“ ${group.campus}</span>
                        </div>
                        <p class="group-card-description">${group.description}</p>
                        <div class="tags">
                            ${group.categories.map(cat => `<span class="tag">${cat}</span>`).join('')}
                        </div>
                        <div class="group-card-footer">
                            <span class="group-members">ğŸ‘¥ ${group.members} members</span>
                            <a href="group-detail.html?id=${group.id}" class="btn btn-sm btn-primary">View</a>
                        </div>
                    </div>
                </div>
            `;
        }

        function displayUpcomingEvents(events) {
            const list = document.getElementById('upcoming-events-list');
            list.innerHTML = events.map(event => `
                <div class="card event-card">
                    <div class="event-card-image"></div>
                    <div class="event-card-content">
                        <div class="event-card-header">
                            <div>
                                <h3 class="event-card-title">${event.title}</h3>
                                <div class="event-card-date">ğŸ“… ${new Date(event.date).toLocaleDateString()} at ${event.time}</div>
                                <div class="event-card-location">ğŸ“ ${event.location}</div>
                            </div>
                            ${event.isFree ? '<span class="event-free-tag">FREE</span>' : ''}
                        </div>
                        <p class="event-card-description">${event.description}</p>
                        <div class="tags">
                            ${event.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                        <div class="event-card-footer">
                            <span class="event-host">Hosted by ${event.hostGroup}</span>
                            <div>
                                <span class="event-spots">${event.spotsLeft} spots left</span>
                                <a href="event-detail.html?id=${event.id}" class="btn btn-sm btn-primary ml-1">Register</a>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>

</html>